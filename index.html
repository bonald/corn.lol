<!DOCTYPE html><html><head><meta charset="UTF-8" /><title>corn.lol</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
</head><body><div id="root"></div><div id="footer"></div><script type="text/babel">

    // default minimum trade amounts
    var bitmexMin = 9000;
    var bitfinexMin = 100;


    var showPrices = true;

    // exchanges on
    var bitmexEnabled = true;
    var bitfinexEnabled = true;

    // for font/colors
    var bitmexSize1 = 1;
    var bitmexSize2 = 1000;
    var bitmexSize3 = 10000;
    var bitmexSize4 = 100000;
    var bitmexSize5 = 500000;
    var bitmexSize6 = 1000000;
    var bitfinexSize1 = 1;
    var bitfinexSize2 = 100;
    var bitfinexSize3 = 1000;
    var bitfinexSize4 = 10000;
    var bitfinexSize5 = 50000;
    var bitfinexSize6 = 100000;

    // settings





    // trades container
    var trades = null;

    class Start extends React.Component {


        constructor(props) {
            super(props);
            this.state = {data: []};
            this.instance = this;

            this.setupSettings();

            this.bitmexWebSocketClient();

            this.bitfinexWebSocketClient();




            setInterval(function(){
                document.getElementById("maintablediv").scrollTo({
                    'behavior': 'smooth',
                    'left': 0,
                    'top': 0
                })
            }, 10000);

        }


        bitmexWebSocketClient() {

            var c = this.instance;

            if (c.bitmexSocket != null) {
                c.bitmexSocket.close();
                c.bitmexSocket = null;
            }
            c.bitmexSocket = new WebSocket("wss://www.bitmex.com/realtime?subscribe=trade:XBTUSD");
            c.bitmexSocket.onmessage = function(event) {
                let obj = JSON.parse(event.data);
                if (obj.data == null) {return;}
                let trade = average(obj.data, 5);
                if (trades == null) {
                    trades = trade;
                } else {
                    if (trades.length > 300) {trades.splice(trades.length - 5)}
                    trades = trade.concat(trades);
                }
                c.setStreamData({data: trades});
            };


        }

        bitfinexWebSocketClient() {

            var c = this.instance;

            if (c.bitfinexSocket != null) {
                c.bitfinexSocket.close();
                c.bitfinexSocket = null;
            }
            c.bitfinexSocket = new WebSocket("wss://api.bitfinex.com/ws")
            c.bitfinexSocket.onopen = function() {
                console.log("onopen, sending subscribe trades")
                c.bitfinexSocket.send("{\n" +
                    "  \"event\": \"subscribe\",\n" +
                    "  \"channel\": \"trades\",\n" +
                    "  \"pair\": \"BTCUSD\"\n" +
                    "}")
            };
            c.bitfinexSocket.onmessage = function(event) {

                let trade = JSON.parse(event.data);
                if (trade == null || trade[1] !== "te") {return}

                let trade2 = averageFinex(trade, 5)

                if (trades != null && trades[0].timestamp === trade2[0].timestamp && trades[0].side === trade2[0].side) {
                    trades[0].btcAmt += trade2[0].btcAmt
                    trades[0].size += trade2[0].size
                    trades[0].lastPrice = trade2[0].price
                } else {

                    if (trades == null) {
                        trades = trade2;
                    } else {

                        if (trades.length > 300) {
                            trade2.splice(trades.length - 5);
                        }
                        trades = trade2.concat(trades);
                    }
                }


                c.setStreamData({data: trades});


            };

            c.setStreamData({data: trades});

        }

        setStreamData(data){
            this.setState(data);
        }

        render() {
            return (

                <div id="tableandbottom">

                    <div id="maintablediv">
                        <Table data={this.state.data}/>
                    </div>

                    <div id="hiddendiv">
                        <a id="settingslink" href="#"><img src="https://i.imgur.com/6AoPcNm.png" height="30" width="30"></img></a>
                        <a id="clearlink" href="#"><img src="https://i.imgur.com/NkTQRNj.png" height="30" width="30"></img></a>
                    </div>
                </div>







            );
        }

        setupSettings() {
            window.onload = function() {

                document.getElementById("bitmexMinField").onchange = function() {
                    bitmexMin = document.getElementById("bitmexMinField").value;
                };

                document.getElementById("bitfinexMinField").onchange = function() {
                    bitfinexMin = document.getElementById("bitfinexMinField").value;
                };



                var settingslink = document.getElementById("settingslink");
                settingslink.onclick = function() {
                    var modal = document.getElementById('myModal');
                    var span = document.getElementsByClassName("close")[0];

                    modal.style.display = "block";

                    span.onclick = function() {
                        modal.style.display = "none";
                    }

                    window.onclick = function(event) {
                        if (event.target == modal) {
                            modal.style.display = "none";
                        }
                    }

                };

                var clearlink = document.getElementById("clearlink");
                clearlink.onclick = function() {
                    trades = null;
                }


                document.getElementById('bitmexMinField').value = bitmexMin;
                document.getElementById('bitfinexMinField').value = bitfinexMin;

                document.getElementById('bitmexEnabledButton').checked = bitmexEnabled;
                document.getElementById('bitfinexEnabledButton').checked = bitfinexEnabled;




            };
        }
    }


    function updateBitmexMin() {
        console.log("updatebitmexmin")
        // bitmexMin = document.getElementById("bitmexMin").value;

    }

    class ShowFooter extends React.Component {


        constructor(props) {
            super(props);



        }



        render() {
            return (
                <div>
                    <div id="footerdiv">
                        <div id="footerleft">
                            <b>&hearts; corn.lol </b>
                            <small>[&copy; 2019 boppleton industries]</small>
                        </div>
                        <div id="footerright">
                            <a href="github.com/boppleton">github</a>
                        </div>
                    </div>

                    <div id="myModal" className="modal">

                        <div className="modal-content">
                            <div className="modal-header">
                                <span className="close">&times;</span>
                                <h2>ticker #1 settings</h2>
                            </div>

                            <div className="modal-body">
                                <div className="settingsitem">
                                    <input id="bitmexEnabledButton" type="checkbox" name="bitmexEnabledButton"/>
                                    <b>  bitmex  </b>
                                    <input id="bitmexMinField" type="number" name="bitmexMinField" min="1" max="10000000"/>
                                </div>

                                <div className="settingsitem">
                                    <input id="bitfinexEnabledButton" type="checkbox" name="bitfinexEnabledButton"/>
                                    <b>  bitfinex  </b>
                                    <input id="bitfinexMinField" type="number" name="bitfinexMinField" min="1" max="10000000"/>
                                </div>


                            </div>

                            <div className="modal-footer">
                                <hr/><hr/><hr/>
                            </div>
                        </div>
                    </div>
                </div>




            );
        }
    }

    function getMinForExchange(data) {
        if (data.exchangeName==="bitmex") {
            return bitmexMin;
        } else if (data.exchangeName==="bitfinex") {
            return bitfinexMin;
        }
    }

    function lowFormat(size) {

        return Math.abs(Math.round(size)).toFixed(0);
    }

    function getKformat(size, iteration) {

            if (size < 1000) {
                return lowFormat(size);
            }

            var c = ["k", "m"];

            var d = (size / 100) / 10.0;
            var isRound = (d * 10) % 10 === 0;//true if the decimal part is equal to 0 (then it's trimmed anyway)
            return (d < 1000 ? //this determines the class, i.e. 'k', 'm' etc
                ((d > 99.9 || isRound || (!isRound && d > 9.99) ? //this decides whether to trim the decimals
                        d.toFixed(0) * 10 / 10 : d.toFixed(1) + "" // (int) d * 10 / 10 drops the decimal
                ) + "" + c[iteration]) : getKformat(d, iteration + 1) ) ;


    }

    class Row extends React.Component {
        render() {
            const {data} = this.props;
            const row = data.map((data, i) =>
                <tr className={"traderow " + data.exchangeName + " " + getSizeGroup(data) + " " + (Math.abs(data.size)<getMinForExchange(data)?"hide":"")} key={i} bgcolor={getBgColor(data)}>
                    <td id="tradeIcon">{getIcon(data)}</td>
                    <td id="tradeSize">{getKformat(Math.abs(data.size), 0)}</td>
                    <td width="100%" id="spacer">{" "}</td>

                    <td id="slip">{this.getSlip(data)}</td>

                    <td id="btcAmt">{this.getBtcShow(data)}</td>

                    <td id="tradePrice">{showPrices?("@ " + data.lastPrice.toFixed(1)):null}</td>
                    <td id="elapsedTime">{ getTimeElapsed(data)}</td>
                </tr>
            );
            return (<tbody>{row}</tbody>);
        }

        getBtcShow(data) {
            if (data.exchangeName==="bitfinex") {
                return " " + Math.abs(data.btcAmt.toFixed(2)) + " btc "
            } else {
                return null;
            }
        }

        getSlip(data) {

            var slip = data.lastPrice-data.firstPrice

            if (Math.abs(slip)>=0.5) {
                return (slip<0?"↘ ":"↗ ") + Math.abs(slip).toFixed(1)
            } else {
                return null
            }

        }
    }

    class Table extends React.Component {
        constructor(props) {super(props)}
        render() { return (<table className="table1"><Row data={this.props.data} /></table>)}
    }

    function getSizeGroup(data) {

        if (data.exchangeName==="bitmex") {
            if (data.size >= bitmexSize6) {
                return "size6";
            } else if (data.size >= bitmexSize5) {
                return "size5";
            } else if (data.size >= bitmexSize4) {
                return "size4";
            } else if (data.size >= bitmexSize3) {
                return "size3";
            } else if (data.size >= bitmexSize2) {
                return "size2";
            } else {
                return "size1";
            }
        } else if (data.exchangeName==="bitfinex") {
            if (Math.abs(data.size) >= bitfinexSize6) {
                return "size6";
            } else if (Math.abs(data.size) >= bitfinexSize5) {
                return "size5";
            } else if (Math.abs(data.size) >= bitfinexSize4) {
                return "size4";
            } else if (Math.abs(data.size) >= bitfinexSize3) {
                return "size3";
            } else if (Math.abs(data.size) >= bitfinexSize2) {
                return "size2";
            } else {
                return "size1";
            }
        }

    }

    function getTimeElapsed(data) {

        var timeElapsed = parseInt((Date.now()-data.startTime)/1000);

        if (timeElapsed===0) {
            return "now";
        } else if (timeElapsed < 60) {
            return timeElapsed + "s";
        } else {
            return parseInt(timeElapsed/60) + "m"
        }

    }

    function getTime(data) {
        return parseInt((Date.now()-data.startTime)/1000);
    }

    function rgb2hex(red, green, blue) {
        var rgb = blue | (green << 8) | (red << 16);
        return '#' + (0x1000000 + rgb).toString(16).slice(1)
    }

    function getBgColor(data) {

        var side = data.side;
        var size = Math.abs(data.size);

        var intensity = Math.abs(size) / 4200;

        if (intensity > 165) {
            intensity = 165;
        } else if (intensity < 1) {
            intensity = 1;
        }

        if (side) {
            // return new Color(170 - intensity, 255 - intensity / 2, 170 - intensity);
            return rgb2hex(170 - intensity, 255 - intensity / 2, 170 - intensity)
        } else {
            // return new Color(255 - intensity / 2, 170 - intensity, 170 - intensity);
            return rgb2hex(255 - intensity / 2, 170 - intensity, 170 - intensity)
        }

    }

    function getIcon(data) {

        if (data.exchangeName==="bitmex") {
            return <img src="https://i.imgur.com/87OPgLV.png"></img>
        } else if (data.exchangeName==="bitfinex") {
            return <img src="https://i.imgur.com/tEMPQFj.png"></img>
        }

    }



    function formatAMPM(date) {
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var seconds = date.getSeconds();
        var ampm = hours >= 12 ? 'pm' : 'am';
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        minutes = minutes < 10 ? '0'+minutes : minutes;
        seconds = seconds < 10 ? '0'+seconds : seconds;
        var strTime = hours + ':' + minutes + ':' + seconds + ' ' + ampm;
        return strTime;
    }

    function averageFinex(trade) {

        var results = [];

        results.push({
            symbol: "BTCUSD",
            price:trade[4],
            size: parseInt(trade[5]*trade[4]),
            timestamp: trade[3],
            side: trade[5]>0,
            exchangeName: "bitfinex",
            startTime: Date.now(),
            btcAmt: trade[5],
            firstPrice: trade[4],
            lastPrice: trade[4]
        });

        return results;

    }

    function average(arr, priceFilter) {
        var sumSizeArr = {}, sumPriceArr= {}, results = [], timestamp, side;

        var firstPrice;
        var lastPrice;

        firstPrice = arr[0].price;
        lastPrice = arr[arr.length-1].price;



        for (var i = 0; i < arr.length; i++) {
            var item = arr[i];
            var key = item.timestamp + item.side;
            var pr = item.priceSum
            if (!(key in sumSizeArr)) {
                sumSizeArr[key] = {};
                sumSizeArr[key].sizeSum = item.size;
            } else {
                sumSizeArr[key].sizeSum += arr[i].size;
            }
        }

        for (var i = 0; i < arr.length; i++) {
            var item = arr[i];
            var key = item.timestamp + item.side;
            var sizeItem = sumSizeArr[key];
            if (!(key in sumPriceArr)) {
                sumPriceArr[key] = {};
                sumPriceArr[key].symbol = item.symbol;
                sumPriceArr[key].priceSum = item.price * item.size / sizeItem.sizeSum;
                sumPriceArr[key].sizeSum = item.size;
                sumPriceArr[key].timestamp = formatAMPM(new Date(item.timestamp));
                sumPriceArr[key].side = item.side;
            } else {
                sumPriceArr[key].priceSum += item.price * item.size / sizeItem.sizeSum;
                sumPriceArr[key].sizeSum += item.size;
            }
        }

        for(key in sumPriceArr) {
            var item = sumPriceArr[key];
            if (item.sizeSum >= priceFilter)
            {
                results.push({
                    symbol: item.symbol,
                    price:item.priceSum.toFixed(2),
                    size: item.sizeSum,
                    timestamp: item.timestamp,
                    side: item.side==="Buy",
                    exchangeName: "bitmex",
                    startTime: Date.now(),
                    firstPrice: firstPrice,
                    lastPrice: lastPrice
                });
            }
        }
        return results;
    }





    ReactDOM.render(<Start />, document.getElementById('root'));

    ReactDOM.render(<ShowFooter />, document.getElementById('footer'));


</script>

<style>

    * {
        margin: 0;
        padding: 0;
    }

    body, html {
        width: 100%;
        height: 100%;


        overflow: hidden;

        background:
                radial-gradient(black 15%, transparent 16%) 0 0,
                radial-gradient(black 15%, transparent 16%) 8px 8px,
                radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 0 1px,
                radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 8px 9px;
        background-color:#282828;
        background-size:16px 16px;
    }

    #icon img {
        /*width: 100%;*/
    }


    a {
        color: #858585;
    }

    #footer {
        font-family: 'Raleway', sans-serif;

        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        background-color: #4f4f4f;
        color: #858585;
        text-align: left;


    }

    #footerdiv {
        padding: 5px;
    }

    #footerdiv b {
        font-size: 18px;
        color: #9c9c9c;
        /*-webkit-text-stroke: 1px black;*/
    }

    #footerleft {
        float: left;
        text-align: left;

    }

    #footerleft {
        text-align: center;
    }

    #footerright {
        text-align: right;
    }

    #maintablediv {

        border: 2px solid #525252;

        margin: 5px;
        /*padding: 2px;*/
        width: 240px;
        height: 780px;

    }



    #maintablediv {
        overflow: hidden;
        resize: both;

        max-height: available;

    }

    #maintablediv:hover {
        overflow-y: scroll;

    }

    #hiddendiv{
        display: none;

        float: left;



    }

    #tableandbottom {
        width: max-content;
    }

    #hiddendiv img {
        padding: 5px 15px 5px 5px;
        /*float: left;*/
    }

    #tableandbottom:hover > #hiddendiv{
        display: inline-block;

        /*float: left;*/

        /*width: fit-content;*/
        /*height: fit-content;*/

        width: 120px;

        padding-top: 5px;




        background-color: rgba(1,1,1,0.7);

        position: relative;
        top: -75px;
        left: 23px;


        text-align: center;

        color: white;


    }


    #maintablediv::-webkit-scrollbar-track
    {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        background-color: rgba(1, 1, 1, 0.2);
    }

    #maintablediv::-webkit-scrollbar
    {
        width: 20px;
        height: 20px;
        background-color: rgba(0,0,0,0);
    }

    #maintablediv::-webkit-scrollbar-thumb
    {
        background-color: rgba(1,1,1,0.4);
        border: 2px solid rgba(100,100,100,0.7);
    }






    .table1
    {
        border: 5px red;
        background-color: rgba(0, 0, 0, 0);
        border-collapse: collapse;
        border-spacing: 0;
        font-size: 14px;



    }
    .table1 .traderow td
    {
        margin: 0px;
        padding: 0px;
        white-space: nowrap;
        /*border-left: 1px solid black;*/
        text-align: left;
        /*font-size: 14px;*/
        font-family: sans-serif;

        border: 0;
    }



    .traderow {
        /*border-top: 1px solid black;*/
    }

    .bitmex.size1{
        color: #5d5d5d;
        font-style: italic;
        font-size: 16px;
    }

    .bitmex.size2{
        color: #414141;
        font-size: 18px;
    }

    .bitmex.size3{
        color: black;
        font-size: 20px;
    }

    .bitmex.size4{
        color: black;
        font-size: 22px;
        font-weight: bold;

    }
    .bitmex.size5{
        color: white;
        font-size: 24px;
        font-weight: bold;
    }
    .bitmex.size6{
        color: yellow;
        border: yellow 3px;
        font-weight: bold;
        font-size: 26px;
    }

    .bitfinex.size1 {
        color: #5d5d5d;
        /*font-style: italic;*/
        font-size: 16px;

    }

    .bitfinex.size2 {
        color: #414141;
        font-size: 18px;

    }

    .bitfinex.size3 {
        color: black;

        font-size: 20px;

    }

    .bitfinex.size4 {
        color: black;

        font-size: 22px;

    }

    .bitfinex.size5 {
        color: white;

        font-size: 24px;

    }

    .bitfinex.size6 {
        font-size: 26px;

        color: yellow;
        border: yellow 3px;
    }

    .hide {
        display: none;
    }

    #btcAmt
    {
        /*color: #343434;*/
        font-size: 12px;
        padding-right: 5px;

    }


    #tradeSize {
        padding-left: 5px;
    }

    #tradeIcon {
        padding: 0px;
        padding-left: 4px;
    }

    #elapsedTime {
        font-size: 11px;
        font-style: italic;
        font-weight: normal;
        /*color: #858585;*/
        padding-right: 5px;
    }

    #tradePrice {
        font-size: 12px;
        padding-right: 5px;
        font-weight: normal;
        font-style: normal;
        /*color: #5a5a5a;*/
    }

    #slip {
        /*color: #321439;*/
        font-size: 13px;
        font-weight: normal;
        padding-right: 5px;

    }




    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        -webkit-animation-name: fadeIn; /* Fade in the background */
        -webkit-animation-duration: 0.4s;
        animation-name: fadeIn;
        animation-duration: 0.4s
    }

    /* Modal Content */
    .modal-content {
        position: fixed;
        bottom: 0;
        background-color: #fefefe;
        width: 100%;
        -webkit-animation-name: slideIn;
        -webkit-animation-duration: 0.4s;
        animation-name: slideIn;
        animation-duration: 0.4s
    }

    /* The Close Button */
    .close {
        color: white;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-header {
        padding: 2px 16px;
        background-color: #5cb85c;
        color: white;
    }

    .modal-body {
        padding: 10px
    }

    .settingsitem {
        padding: 10px;
    }

    .modal-footer {
        padding: 2px 16px;
        background-color: #5cb85c;
        color: white;
    }

    /* Add Animation */
    @-webkit-keyframes slideIn {
        from {bottom: -300px; opacity: 0}
        to {bottom: 0; opacity: 1}
    }

    @keyframes slideIn {
        from {bottom: -300px; opacity: 0}
        to {bottom: 0; opacity: 1}
    }

    @-webkit-keyframes fadeIn {
        from {opacity: 0}
        to {opacity: 1}
    }

    @keyframes fadeIn {
        from {opacity: 0}
        to {opacity: 1}
    }



</style>

</body></html>
